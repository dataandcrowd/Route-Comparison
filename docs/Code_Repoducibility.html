<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Finding Who Walks: Writing Reproducible code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Code_Repoducibility_files/libs/clipboard/clipboard.min.js"></script>
<script src="Code_Repoducibility_files/libs/quarto-html/quarto.js"></script>
<script src="Code_Repoducibility_files/libs/quarto-html/popper.min.js"></script>
<script src="Code_Repoducibility_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Code_Repoducibility_files/libs/quarto-html/anchor.min.js"></script>
<link href="Code_Repoducibility_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Code_Repoducibility_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Code_Repoducibility_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Code_Repoducibility_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Code_Repoducibility_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#procedure" id="toc-procedure" class="nav-link active" data-scroll-target="#procedure"><span class="header-section-number">1</span> Procedure</a></li>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages"><span class="header-section-number">2</span> Load Packages</a></li>
  <li><a href="#load-gps-file" id="toc-load-gps-file" class="nav-link" data-scroll-target="#load-gps-file"><span class="header-section-number">3</span> Load GPS file</a></li>
  <li><a href="#task-1-filtering-speed" id="toc-task-1-filtering-speed" class="nav-link" data-scroll-target="#task-1-filtering-speed"><span class="header-section-number">4</span> Task 1: Filtering Speed</a>
  <ul class="collapse">
  <li><a href="#how-to-set-the-journey-from-home" id="toc-how-to-set-the-journey-from-home" class="nav-link" data-scroll-target="#how-to-set-the-journey-from-home"><span class="header-section-number">4.1</span> How to set the journey from home?</a></li>
  <li><a href="#how-to-set-when-they-arrive-at-school" id="toc-how-to-set-when-they-arrive-at-school" class="nav-link" data-scroll-target="#how-to-set-when-they-arrive-at-school"><span class="header-section-number">4.2</span> How to set when they arrive at School</a></li>
  <li><a href="#finalising-trajectory" id="toc-finalising-trajectory" class="nav-link" data-scroll-target="#finalising-trajectory"><span class="header-section-number">4.3</span> Finalising Trajectory</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Finding Who Walks: Writing Reproducible code</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Hello! Welcome to my coding page. Here, I will walk you through the process of working with GPS data. We will start by loading the necessary packages for our analysis. Each package has annotations to explain its role.</p>
<section id="procedure" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Procedure</h1>
<ol type="1">
<li><p>Collect GPS Trajectories</p></li>
<li><p>GPS Merge and Cleaning 1: Filtering Speed (9km/h)</p></li>
<li><p>GPS Merge and Cleaning 2: Considering the Actual Journey</p></li>
</ol>
<p><del>4. Snap it on to the road network</del></p>
<p><del>5. Superimpose NO</del><sub>2</sub></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="procedure.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Procedure (Will be updated)</figcaption>
</figure>
</div>
</section>
<section id="load-packages" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Load Packages</h1>
<p>In this section, we load the packages required for our GPS data analysis. Below are the packages and their respective functionalities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary packages (assuming they are already installed)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)        <span class="do">## Analyse GIS vector files</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapboxapi) <span class="do">## mapbox api routing</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsapi)   <span class="do">## google api routing</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)      <span class="do">## osm api routing</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="do">## Everything data querying cleaning &amp; plotting</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)   <span class="do">## Online mapping </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)    <span class="do">## Online visualisation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)   <span class="do">## online maps</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)   <span class="do">## clean data names</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)     <span class="do">## raster</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="do">## colour codes</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(encryptr) <span class="do">## Encrypt personal information</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-gps-file" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Load GPS file</h1>
<p>It reads a GPS trajectory data file called <code>trajectory_to_school.RDS</code> into the <code>trajectory_raw</code> data frame. It then filters this data frame to include only records with a timestamp between 7 AM (inclusive) and 9 AM (exclusive). The filtered data is stored in ‘trajectory_raw’. Additionally, a new column <code>date</code> is added to the data frame, containing the date portion of the <code>timestamp</code> column.</p>
<p>The code displays the resulting <code>trajectory_raw</code> data frame in the R console.</p>
<p>Next, it loads address data from a CSV file called “address.csv” into the ‘address’ data frame. The column names are cleaned to ensure consistency, and the <code>id</code> column is renamed to <code>PartID</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the GPS trajectory data from a saved RDS file called "trajectory_to_school.RDS"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data to include only records with a timestamp between 7 AM (inclusive) and 9 AM (exclusive)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column 'date' to the data using the 'timestamp' column</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>trajectory_raw <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"trajectory_to_school.RDS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">hour</span>(timestamp) <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> <span class="fu">hour</span>(timestamp) <span class="sc">&lt;</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(timestamp))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting 'trajectory_raw' data frame</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>trajectory_raw <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">encrypt</span>(PartID, long, lat, SIMDQ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 9
   PartID           timestamp           long  lat   SpdKPH Activity SIMDQ Gender
   &lt;chr&gt;            &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt;
 1 3987db85bda1eb4… 2015-12-04 07:44:33 31d8… 3fdb… 0      Light    7a5a…      0
 2 66f8af4ab3c4e7a… 2015-12-04 07:44:43 0adb… 68b5… 9.91   Moderate cc5a…      0
 3 8b35180b95ec878… 2015-12-04 07:44:53 3f0a… 0bf4… 3.25   Vigorous 49c0…      0
 4 c7b609cf2247cda… 2015-12-04 07:45:03 6d8a… 3fbb… 1.55   Light    0b0b…      0
 5 854c571193fa115… 2015-12-04 07:45:13 93c3… 6f6d… 1.21   Sedenta… b19a…      0
 6 d7accca25ea4018… 2015-12-04 07:45:23 be26… e6ec… 0.155  Light    065e…      0
 7 2c86ca49913ceec… 2015-12-04 07:45:33 1bf8… 18d8… 0.414  Sedenta… 0f9f…      0
 8 48be79caf5a587a… 2015-12-04 07:45:43 4da5… 2cd7… 0.0504 Light    5f2e…      0
 9 d7c3687ec1fa0f2… 2015-12-04 07:45:53 d6e9… 0009… 0.385  Light    dd17…      0
10 c5822915ef2e2c8… 2015-12-04 07:46:03 9314… a4ca… 0.220  Moderate 3cf8…      0
11 25f4224881b91a8… 2015-12-04 07:46:13 c67d… 58bc… 0.623  Light    08b0…      0
12 0c8d005a4d4ea38… 2015-12-04 07:46:23 b353… e84f… 0.27   Light    a002…      0
13 bb60086e6ec3b0d… 2015-12-04 07:46:33 d3a3… b477… 0.317  Light    9cda…      0
14 4a472ff697c5275… 2015-12-04 07:46:43 12e1… ea1c… 0.508  Light    3bb5…      0
15 a669f6bef6f3885… 2015-12-04 07:46:53 0035… e5f9… 0.0396 Sedenta… 6424…      0
16 5a4a535e39779c4… 2015-12-04 07:47:03 8594… 3afd… 0.886  Sedenta… 1ff9…      0
17 9507126ef9da78e… 2015-12-04 07:47:13 1ba9… 5f9e… 1.26   Light    4374…      0
18 b7aa0d36608d7c8… 2015-12-04 07:47:23 38f0… 96cd… 1.19   Light    2cea…      0
19 0e88c188d3548ca… 2015-12-04 07:47:33 1f54… 9704… 1.04   Light    40f5…      0
20 2526e80aa0edcf5… 2015-12-04 07:47:43 2076… 3244… 0.713  Sedenta… 4b30…      0
# ℹ 1 more variable: date &lt;date&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load address data from a CSV file called "address.csv"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the column names and rename the 'id' column to 'PartID'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>address <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"address.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">PartID =</span> id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-1-filtering-speed" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Task 1: Filtering Speed</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="GPS_Filter_1.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Flow Algorithm to filter out Speed over 9km/h</figcaption>
</figure>
</div>
<p>This code creates a scatter plot showing the GPS trajectory points for a specific ‘PartID’ (“XXX”) from the <code>spaces_under_9km</code> data frame. It colors the points based on the date, and it also adds blue and red points to represent the home and school locations, respectively. In the context of the Air Pollution Study, we provide a comprehensive list of all valid dates for each child. However, for the Route Choice Study, we select only one of the valid days for analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform several data manipulation steps on the 'trajectory_raw' data frame:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Group the data by 'PartID'.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Filter the data to include only records where 'SpdKPH' is less than 9.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>trajectory_raw <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PartID) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SpdKPH <span class="sc">&lt;</span> <span class="dv">9</span>) <span class="ot">-&gt;</span> spaces_under_9km</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatter plot using ggplot2 for a specific 'PartID' ("10659P") from the 'spaces_under_9km' data frame.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot latitude ('lat') on the y-axis and longitude ('long') on the x-axis.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Color the points based on the 'date' factor.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additionally, plot the home and school locations as blue and red points, respectively.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> spaces_under_9km <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>), <span class="fu">aes</span>(long, lat)) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">as.factor</span>(date))) <span class="sc">+</span>  <span class="co"># Plot the trajectory points</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> address <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(PartID, home_lat, home_long),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> home_long, <span class="at">y =</span> home_lat), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span>  <span class="co"># Plot the home location</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> address <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(PartID, school_lat, school_long),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> school_long, <span class="at">y =</span> school_lat), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="ot">-&gt;</span> a  <span class="co"># Plot the school location</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the ggplot2 plot 'a' to an interactive plot using ggplotly.</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="how-to-set-the-journey-from-home" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="how-to-set-the-journey-from-home"><span class="header-section-number">4.1</span> How to set the journey from home?</h2>
<p><img src="GPS_Filter_2.jpg" class="img-fluid"></p>
<p>This code performs spatial filtering and selection operations to find the last point at home for specific <code>PartID</code> values and all children in the <code>trajectory_sf</code> dataset. It also visualises the trajectory and home buffer for two different ‘PartID’ values (XXX and YYY) as examples. Make sure you have the necessary spatial libraries loaded for this code to work correctly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the 'address' dataset to a spatial dataframe for home addresses.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>address <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"home_long"</span>, <span class="st">"home_lat"</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>) <span class="ot">-&gt;</span> home_address_sf</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the 'address' dataset to a spatial dataframe for school addresses.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>address <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"school_long"</span>, <span class="st">"school_lat"</span>), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>) <span class="ot">-&gt;</span> school_address_sf</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a buffer around home addresses for further analysis.</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>home_address_sf <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">27700</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="ot">-&gt;</span> home_buffer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example for 'PartID' XXX: Visualize trajectory and home buffer.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(trajectory_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(home_buffer <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>), <span class="at">col.regions =</span> <span class="st">"red"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the trajectory for 'PartID' XXX within the home buffer and select the time_sequence.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(home_buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time_sequence) <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Example for 'PartID' YYY: Visualize trajectory and home buffer.</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(trajectory_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>)) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(home_buffer <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>), <span class="at">col.regions =</span> <span class="st">"red"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the trajectory for 'PartID' YYY within the home buffer and select the time_sequence.</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(home_buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time_sequence) <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># For all children: Filter trajectories within the home buffer and select the last point at home.</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(home_buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PartID, time_sequence) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PartID) <span class="sc">%&gt;%</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>(time_sequence) <span class="sc">==</span> <span class="fu">n</span>()) <span class="ot">-&gt;</span> last_point_at_home</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-to-set-when-they-arrive-at-school" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="how-to-set-when-they-arrive-at-school"><span class="header-section-number">4.2</span> How to set when they arrive at School</h2>
<p>This code visualises the trajectories, home addresses, school addresses, and school buildings for specific ‘PartID’ values and identifies the first point at school for each ‘PartID’. Make sure you have the necessary spatial libraries loaded for this code to work correctly.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the school building shapefile.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>school_building <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"gis/scottishschool_4326.shp"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example for 'PartID' XXX: Visualize trajectory, home address, school address, and school building.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(trajectory_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>)) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(home_address_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>), <span class="at">col.regions =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(school_address_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>), <span class="at">col.regions =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(school_building)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the trajectory for 'PartID' XXX within the school building and select the time_sequence.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(school_building) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time_sequence) <span class="sc">%&gt;%</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize a slice of the trajectory for 'PartID' XXX.</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"XXX"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">246</span><span class="sc">:</span><span class="dv">310</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>()</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Example for 'PartID' YYY: Visualize trajectory, home address, school address, and school building.</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(trajectory_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>)) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(home_address_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>), <span class="at">col.regions =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(school_address_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>), <span class="at">col.regions =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(school_building)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the trajectory for 'PartID' YYY within the school building and select the time_sequence.</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(school_building) <span class="sc">%&gt;%</span> </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time_sequence) <span class="sc">%&gt;%</span> </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize a specific time sequence for 'PartID' YYY.</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PartID <span class="sc">==</span> <span class="st">"YYY"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_sequence <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">236</span><span class="sc">:</span><span class="dv">331</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>()</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co"># For all children: Filter trajectories within the school building and select the first point at school.</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(school_building) <span class="sc">%&gt;%</span> </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PartID, time_sequence) <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PartID) <span class="sc">%&gt;%</span> </span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>(time_sequence) <span class="sc">==</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> first_point_at_school</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="finalising-trajectory" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="finalising-trajectory"><span class="header-section-number">4.3</span> Finalising Trajectory</h2>
<p>This code first joins the <code>last_point_at_home</code> and <code>first_point_at_school</code> datasets to create ‘home_school_index.’ Then, it filters the <code>trajectory_sf</code> dataset to include only the data between home and school times for each <code>PartID</code>. Finally, it calculates the time taken for each <code>PartID</code> to travel from home to school by finding the difference between the maximum and minimum timestamps for each ‘PartID.’</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the 'time_sequence' column in 'last_point_at_home' and join it with 'first_point_at_school'.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>last_point_at_home <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">time_home =</span> time_sequence) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(first_point_at_school, <span class="at">by =</span> <span class="st">"PartID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">time_school =</span> time_sequence) <span class="ot">-&gt;</span> home_school_index</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join 'trajectory_sf' with 'home_school_index' based on 'PartID'.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>trajectory_sf <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(home_school_index, <span class="at">by =</span> <span class="st">"PartID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter the trajectory to include only data between home and school times.</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_sequence <span class="sc">&gt;=</span> time_home) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_sequence <span class="sc">&lt;=</span> time_school) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the 'time_home' and 'time_school' columns.</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(time_home, time_school)) <span class="ot">-&gt;</span> trajectory_final</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the 'trajectory_final' dataset.</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(trajectory_final)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the time taken for each 'PartID' to travel from home to school.</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>trajectory_final <span class="sc">%&gt;%</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PartID) <span class="sc">%&gt;%</span> </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">time_taken =</span> <span class="fu">max</span>(timestamp) <span class="sc">-</span> <span class="fu">min</span>(timestamp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>